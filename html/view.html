<!DOCTYPE html>
<html>
<!-- https://qiita.com/hibit/items/0d119d171bcbe3b2c1c5 -->
<head>
</head>

<body>
    <script src="three.js"></script>
    <script src="GLTFLoader.js"></script>
    <script src="three-vrm.js"></script>
    <script>
        // シーンの準備
        const scene = new THREE.Scene()

        // カメラの準備
        const camera = new THREE.PerspectiveCamera(45, 960 / 540, 0.1, 1000)
        camera.position.set(0, 1.4, -1.0)
        camera.rotation.set(0, Math.PI, 0)

        // レンダラーの準備
        const renderer = new THREE.WebGLRenderer()
        renderer.setSize(960, 540)
        document.body.appendChild(renderer.domElement)

        // ライトの準備
        const directionalLight = new THREE.DirectionalLight('#ffffff', 1)
        directionalLight.position.set(1, 1, 1)
        scene.add(directionalLight)

        const loader = new THREE.GLTFLoader();
        loader.load(

            // URL of the VRM you want to load
            'AliciaSolid.vrm',

            // called when the resource is loaded
            (gltf) => {

                // generate a VRM instance from gltf
                THREE.VRM.from(gltf).then((vrm) => {

                    // add the loaded vrm to the scene
                    scene.add(vrm.scene);

                    // deal with vrm features
                    console.log(vrm);

                    // 筆者追記、両手を下ろす
                    normalPose(vrm);

                    // 筆者追記、笑顔に
                    vrm.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.Joy, 1.0)
                    vrm.blendShapeProxy.update()

                });

            },
            // called while loading is progressing
            (progress) => console.log('Loading model...', 100.0 * (progress.loaded / progress.total), '%'),

            // called when loading has errors
            (error) => console.error(error)

        )

        const normalPose = (vrm) => {
            const leftUpperArm = vrm.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftUpperArm)
            leftUpperArm.rotateZ(1.2)
            const rightUpperArm = vrm.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightUpperArm)
            rightUpperArm.rotateZ(-1.2)
        }


        // アニメーションループの開始
        function tick() {
            requestAnimationFrame(tick)
            renderer.render(scene, camera)
        }
        tick()
    </script>
</body>

</html>